<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body {
            text-align: center;
            font-family: Arial, Helvetica, sans-serif;
            font-size: 20pt;
        }

        .screen {
            text-align: center;
        }

        button {
            border: solid 2px;
            border-radius: 10pt;
            font-size: 20pt;
            padding: 10pt;
            min-width: 200pt;
            margin-bottom: 10pt;
        }

        .creature {
            border: solid 2px;
            border-radius: 10pt;
            font-size: 20pt;
            padding: 10pt;
            min-width: 200pt;
            margin-bottom: 10pt;
            text-align: left;
            display: flex;
        }

        #tocatch {
            width: 100pt;
            height: 100pt;
        }
        td{
            background: #aaa; 
            border-radius: 10pt;
            padding: 10pt;
        }
        .backbutton{
            background: #aaa; 
            border: solid 0px;
            border-radius: 10pt;
            font-size: 20pt;
            padding: 3pt;
            padding-top: 10pt;
            padding-bottom: 10pt;
            
            min-width: 100pt;
            margin-bottom: 10pt;
        }
        .trait{
            border-radius: 10pt;
            padding: 7pt; 
            color:white;
            -webkit-text-stroke: 1pt black;
            font-weight: bold;
            margin-left: 5pt;
        }
    </style>
</head>

<body>
    <div id="mainscreen" class="screen" style="display:none;">
        <h1>Pico Creatures</h1>
        <div>
            <button onclick="creaturescreen()">
                Catch
            </button>
        </div>
        <div>
            <button onclick="opencatched()">
                Creatures
            </button>
        </div>
        <div>
            <button>
                Fight
            </button>
        </div>
        <div>
            <button>
                Library
            </button>
        </div>
        <div>
            <button onclick="showscreen('inventory')">
                Inventory
            </button>
        </div>
        <div>
            <button onclick="showscreen('refillstation')">
                Refill Station
            </button>
        </div>
    </div>
    <div id="creaturescreen" class="screen" style="display:none;">
        <div style="width: 100%;text-align: left;">
            <button class="backbutton" onclick="showscreen('mainscreen')"><-</button></div>
        <h2>Creatures</h2>
        <div id="creatures">

        </div>
    </div>
    <div id="catchscreen" class="screen" style="display:none;">
        <div style="width: 100%;text-align: left;">
            <button class="backbutton" id="backbtncatch" onclick="showscreen('creaturescreen')"><-</button></div>
        <div>
            Nets:<span id="netcountspan">10</span>
        </div>
        <div>
            Fruits:<span id="fruitcount">10</span>
        </div>
        <br>
        <span id="catchname"></span>
        <span id="catchstatus"></span>
        <br>
        <br>
        <img id="tocatch" src="asdf">
        <br>
        <br>
        <small>v</small>
        <div>
            <progress id="progressBar" max="100" value="0"></progress>
        </div>
        <br>
        <br>
        <script>
            const progressBar = document.getElementById("progressBar");
            let progressBarvalue = 0;
            let direction = 1; // 1 for increasing, -1 for decreasing
            let doanim = true;
            function animateProgress() {
                if (doanim) {
                    progressBarvalue += direction;

                    if (progressBarvalue >= 100 || progressBarvalue <= 0) {
                        direction *= -1; // Reverse the direction
                    }
                    progressBar.value = progressBarvalue;
                }
                requestAnimationFrame(animateProgress); // Keep the animation smooth
            }

            animateProgress(); // Start the animatio
            let netcount = 10;
            let fruitcount = 10;
            function updatecounts(){
                netcountspan = document.getElementById("netcountspan");
                netcountspan.textContent = ""+netcount;
                fruitcountspan = document.getElementById("fruitcount");
                fruitcountspan.textContent = ""+fruitcount;
            }
            function docatch() {
                if(netcount<=0){
                    netcount = 0;
                    document.getElementById("catchstatus").textContent = "no more nets";
                    return;
                }
                
                netcount--;
                updatecounts();
                

                const btncatch = document.getElementById("btncatch");
                const backbtncatch = document.getElementById("backbtncatch");
                btncatch.disabled = true;
                backbtncatch.disabled = true;
                doanim = false;
                let t = progressBarvalue / 100 - 0.5;
                t *= 2;

                

                document.getElementById("catchstatus").textContent = "catching...";
                if (1 - t * t + Math.random() > 1.5){
                    setTimeout(e=>{
                        document.getElementById("catchstatus").textContent = "success!";
                        
                        tocatch.splice(tocatch.indexOf(currentcreature),1);
                        c = generateIndividual(pickRandom(allcreatures));
                        catchedcreatures.push(c)
                        setTimeout(e=>{
                            btncatch.disabled = false;
                            backbtncatch.disabled = false;
                            showscreen("creatureinfo")
                            document.getElementById("creatureinfo").querySelector(".backbutton").onclick=e=>{
                                creaturescreen();
                            }
                        },1000)
                    },1500)
                }else{
                    setTimeout(e=>{
                        document.getElementById("catchstatus").textContent = "failed!";
                        doanim = true;
                        btncatch.disabled = false;
                        backbtncatch.disabled = false;
                    },1500)
                }

            }
        </script>
        <div>
            <button onclick="docatch()" id="btncatch">Catch</button>
            <button id="btnfruit">Give Fruit</button>
        </div>
    </div>
    <div id="catchinfo" class="screen"></div>
    <div id="creatureinfo" class="screen" style="display:none;">
        <div style="width: 100%;text-align: left;">
            <button class="backbutton"><-</button></div>
        <div>
        <table>
            <tr>
                <td>
                    Image
                </td>
                <td >
                    <img id="creatureinfoimg" src="asdf">
                </td>
            </tr>
            <tr>
                <td>
                    Name
                </td>
                <td id="creatureinfoname">
                    Test
                </td>
            </tr>
            <tr>
                <td >
                    Height
                </td>
                <td id="creatureinfonheight">
                    0
                </td>
            </tr>
            <tr>
                <td>
                    Width
                </td>
                <td id="creatureinfonwidth">
                    2
                </td>
            </tr>
            <tr>
                <td>
                    Weight
                </td>
                <td id="creatureinfonweight">
                    3
                </td>
            </tr>
            <tr>
                <td>
                    Strength
                </td>
                <td id="creatureinfostrength">
                </td>
            </tr> 
            <tr>
                <td>
                    Traits
                </td>
                <td id="creatureinfontraits">
                    <span class="trait">1</span>
                    <span class="trait">1</span>
                    <span class="trait">1</span>
                    <span class="trait">1</span>
                    <span class="trait">1</span>
                    <span class="trait">1</span>
                </td>
            </tr>
            <tr>
                <td>
                    Evolve Orbs
                </td>
                <td id="creatureinforbs">
                    0
                </td>
            </tr> 
            <tr>
                <td>
                    evolve
                </td>
                <td>
                    <button disabled>evolve</button>
                </td>
            </tr>
            <tr>
                <td>
                    Time Catched
                </td>
                <td id="creatureinfotimecatched">
                </td>
            </tr> 
        </table>
    </div>
    </div>

    <div id="catchedscreen" class="screen">
        
        <div style="width: 100%;text-align: left;">
            <button class="backbutton" onclick="showscreen('mainscreen')"><-</button></div>
        <h2>Catched Creatures</h2>
        <div id="catchedcreatures">

        </div>
    </div>
    <div id="inventory" class="screen">
        <div style="width: 100%;text-align: left;">
            <button class="backbutton" onclick="showscreen('mainscreen')"><-</button></div>
        
        <div>
            <div>
                <table>
                    <tr>
                        <td>Net</td>
                        <td id="netcount">-10</td>
                    </tr>
                    <tr>
                        <td>High Density Net</td>
                        <td id="hdnetcount">-10</td>
                    </tr>
                    <tr>
                        <td>Fruit</td>
                        <td id="fruitcount">-10</td>
                    </tr>
                    <tr>
                        <td>Super Fruit</td>
                        <td id="superfruitcount">-10</td>
                    </tr>
                    <tr>
                        <td>Mega Fruit</td>
                        <td id="megafruitcount">-10</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    <div id="refillstation" class="screen">
        <div style="width: 100%;text-align: left;">
            <button class="backbutton" onclick="showscreen('mainscreen')"><-</button></div>
        
        <h1>Refill Station</h1>
        
        <button id="refillbutton" disabled="">Refill</button>
        <div >
            -<span id="nextrefilltime"></span>-
        </div>
        <div id="newitems">
            -
        </div>
    </div>

    <script src="util.js"></script>
    <script src="imggen.js"></script>
    <script src="namegen.js"></script>
    <script src="gamelogic.js"></script>
    <script src="predefinedcreatures.js"></script>

    <script>
        function showscreen(s){
            document.querySelectorAll(".screen").forEach(e=>{
                e.style.display = "none";
            })
            document.getElementById(s).style.display = "block";
            document.getElementById("catchstatus").textContent = "";
            progressBarvalue = 0;
            doanim = true;
            direction = 1;
        }
        showscreen("mainscreen")
        showscreen("refillstation")
        let catchedcreatures = [];
        
        c = generateIndividual(pickRandom(allcreatures))
        catchedcreatures.push(c);
        
        //opencatched();
        
        creaturemap = {}
        allcreatures.forEach(e=>{
            creaturemap[e.name]=e;
        })

        fillCreatureInfo(c);
        function fillCreatureInfo(c){
            document.getElementById("creatureinfoimg").src=c.type.img; 
            document.getElementById("creatureinfoname").textContent=c.name;
            document.getElementById("creatureinfonweight").textContent=c.weight.toFixed(2);
            document.getElementById("creatureinfonheight").textContent=c.height.toFixed(2);
            document.getElementById("creatureinfonwidth").textContent=c.width.toFixed(2);
            document.getElementById("creatureinfostrength").textContent=c.strength.toFixed(2);
            document.getElementById("creatureinfotimecatched").textContent=c.timecatched;
            creatureinfontraits = document.getElementById("creatureinfontraits")
            creatureinfontraits.innerHTML="";
            c.type.traits.forEach(e=>{
                console.log(e)
                traitspan = document.createElement("span")
                traitspan.className = "trait";
                traitspan.textContent = e;
                traitspan.style.background = traitsWithColors[e];
                creatureinfontraits.appendChild(traitspan)
            })
        }
        
        function creaturescreen(){
            showscreen("creaturescreen");
            document.getElementById("creatures").innerHTML="";
            tocatch.forEach(e=>{
                addCreature(e,"creatures")
            })
        }
        //const base64Image = generateCreatureBase64();
        //document.body.innerHTML = `<img src="${base64Image}" alt="Pixel Creature">`;
        let currentcreature = null;
        function opencatchscreen(c){
            currentcreature = c;
            document.getElementById("tocatch").src = c.img;
            document.getElementById("catchname").textContent = c.name;
            showscreen("catchscreen")
            
        }   
        function opencatched(){
            document.getElementById("catchedcreatures").innerHTML="";
            showscreen("catchedscreen");
            document.getElementById("creatureinfo").querySelector(".backbutton").onclick=e=>{
                showscreen("catchedscreen")
            }
            catchedcreatures.forEach(e=>{
                addCatchedCreature(e);
            })
        }
        function addCreature(c) {
            let divcreature = document.createElement("div");
            divcreature.className = "creature";
            let creatureimg = document.createElement("img");
            creatureimg.src = c.img; 
            let creaturename = document.createElement("span");
            creaturename.textContent = c.name;
            divcreature.appendChild(creatureimg);
            divcreature.appendChild(creaturename)
            document.getElementById("creatures").appendChild(divcreature)
            divcreature.onclick = () => {
                const crt = c;
                opencatchscreen(crt);
            }
        }
        function addCatchedCreature(c) {
            let divcreature = document.createElement("div");
            divcreature.className = "creature";
            let creatureimg = document.createElement("img");
            creatureimg.src = c.type.img;


            let creaturename = document.createElement("span");
            creaturename.textContent = c.name;
            divcreature.appendChild(creaturename)
            let creatureinfotext = document.createElement("span");
            creatureinfotext.textContent = `  
            ${c.timecatched} _ Strength 
            ${c.strength.toFixed(2)}
            `;   

            

            let creatureimgdiv = document.createElement("div");
            creatureimgdiv.appendChild(creatureimg);
            divcreature.appendChild(creatureimgdiv);

            let creaturetextdiv = document.createElement("div");
            creaturetextdiv.appendChild(creaturename);
            creaturetextdiv.appendChild(creatureinfotext);
            divcreature.appendChild(creaturetextdiv);

            
            
            document.getElementById("catchedcreatures").appendChild(divcreature)
            divcreature.onclick = () => {
                const crt = c;
                showscreen("creatureinfo");
                fillCreatureInfo(crt);
            }
            savegame();
        }
        let tocatch = []; 
        for (let i = 0; i < 10; i++) {
            tocatch.push(pickRandom(allcreatures));
        }
        let nextrefill = performance.now()+1000*3;
        let refillbutton = document.getElementById("refillbutton");
        function randInt(min,max){
            return min+Math.floor(Math.random()*(max-min));
        }
        refillbutton.onclick=e=>{
            
            refillbutton.disabled=true;
            nextrefill = performance.now()+1000*3;
            newitems = document.getElementById("newitems");
            newnets = randInt(1,10);
            newfruits = randInt(1,10);
            netcount+=newnets;
            fruitcount+=newfruits;
            newitems.innerHTML =  "+ "+newfruits+" Nets<br>"+ "+ "+newfruits+" Fruits\n";
            savegame();
        };
        setInterval(e=>{
            let a = nextrefill-performance.now();
            a /= 1000;
            a = a.toFixed(0);
            if(a<=0){
                a=0;
                refillbutton.disabled=false;
            }else{
                refillbutton.disabled=true;
            }
            document.getElementById("nextrefilltime").textContent=" "+a+" s ";
        },1)
        function savegame(){
            localStorage.setItem("save",JSON.stringify(
                {
                    netcount,
                    fruitcount,
                    catchedcreatures
                }
            ));
        }
        if(localStorage){
            let savestate = localStorage.getItem("save");
            
            if(savestate){
                savestate = JSON.parse(savestate);
                netcount = savestate.netcount;
                fruitcount = savestate.fruitcount;
                catchedcreatures = savestate.catchedcreatures;
                updatecounts();
                
            }
        }
    </script>

</body>

</html>